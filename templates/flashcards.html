{% extends 'layout.html' %}

{% block content %}
<div class="relative">
  <!-- Saƒü √ºstte streak -->
  <div class="absolute top-0 right-0 bg-midgreen text-white px-4 py-2 rounded-bl-lg">
    üî• Streak: <span id="streak-count">0</span>
  </div>
</div>

<div class="max-w-md mx-auto mt-20 p-6 bg-darkgreen dark:bg-lightgreen text-lightgreen dark:text-darkgreen rounded-lg shadow-lg">
  <!-- Kelime Alanƒ± -->
  <div class="text-center mb-6">
    <h2 class="text-3xl font-bold" id="word-display">{{ word }}</h2>
  </div>

  <!-- Anlam input -->
  <form id="flashcard-form" class="space-y-4">
    <input type="text" id="meaning-input" placeholder="Enter the meaning..." required
           class="w-full px-4 py-2 border border-lightgreen rounded focus:outline-none focus:ring-2 focus:ring-midgreen">

    <button type="submit"
            id="submit-btn"
            class="w-full bg-midgreen text-white py-2 rounded hover:bg-lightgreen hover:text-darkgreen transition">
      Submit
    </button>
  </form>

  <!-- Geri bildirim -->
  <div id="feedback" class="text-center mt-4 font-semibold"></div>

  <!-- √ñrnek c√ºmleler -->
  <div class="mt-6">
    <h3 class="text-lg font-semibold mb-2">Example Sentences:</h3>
    <ul id="sentence-list" class="list-disc pl-5 space-y-1">
      {% for sentence in sentences %}
        <li>{{ sentence }}</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  let streak = 0;
  let state = 'submit';  // 'submit' or 'next'

  const form = document.getElementById("flashcard-form");
  const input = document.getElementById("meaning-input");
  const btn = document.getElementById("submit-btn");
  const feedback = document.getElementById("feedback");
  const streakCount = document.getElementById("streak-count");

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    if (state === 'submit') {
      const userAnswer = input.value.trim();

      const response = await fetch("/flashcard/check", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ word: document.getElementById("word-display").innerText, meaning: userAnswer })
      });

      const result = await response.json();
      if (result.correct) {
        feedback.textContent = "‚úÖ Correct!";
        feedback.className = "text-green-400 text-center mt-4 font-semibold";
        streak += 1;
      } else {
        feedback.textContent = "‚ùå Incorrect. Try again!";
        feedback.className = "text-red-400 text-center mt-4 font-semibold";
        streak = 0;
      }

      streakCount.textContent = streak;
      btn.textContent = "Next";
      state = 'next';
    } else {
      // Yeni kelime i√ßin sayfayƒ± yenile veya AJAX ile √ßek
      window.location.reload();  // Basit √ß√∂z√ºm
    }
  });
</script>
{% endblock %}
